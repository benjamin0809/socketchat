{"version":3,"sources":["../../src/pages/my/updata-phone/updata-phone.module.ts","../../src/pages/my/updata-phone/updata-phone.ts"],"names":[],"mappings":"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","file":"52.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\nimport { updataPhonePage } from './updata-phone';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    updataPhonePage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(updataPhonePage),\r\n    TranslateModule.forChild()\r\n  ],\r\n  exports: [\r\n    updataPhonePage\r\n  ]\r\n})\r\nexport class SetPasswordPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/my/updata-phone/updata-phone.module.ts","import { CacheProvider } from './../../../providers/cache-provider';\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage, ModalController, NavController, ViewController,ToastController,Events } from 'ionic-angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Session, NativeService } from '../../../services/services';\r\nimport { AuthProvider,UserProvider } from '../../../providers/providers';\r\n\r\n@IonicPage()\r\n@Component({\r\n    selector: 'page-updata-phone',\r\n    templateUrl: 'updata-phone.html'\r\n})\r\nexport class updataPhonePage {\r\n    private verifyButtonFixedText:string;\r\n    private sendCodeErrorString:string;\r\n    private verifyButtonText:string;\r\n    private currentUser: any;\r\n    private country:any;\r\n    private verifyButtonEnabled:boolean = false;\r\n    private switch:boolean = false;\r\n    private verifyCode:any;\r\n    private phoneNo:any;\r\n    COUNTDOWN_KEY: string = 'updatePhoneCountDown'; //倒计时KEY\r\n    constructor(public navCtrl: NavController,\r\n        public toastCtrl: ToastController,\r\n        public viewCtrl: ViewController,\r\n        public session: Session,\r\n        private userProvider: UserProvider,\r\n        private authProvider: AuthProvider,\r\n        private nativeService: NativeService,\r\n        private translateService: TranslateService,\r\n        private events:Events,\r\n        public modalCtrl: ModalController,\r\n        public cacheProvider: CacheProvider) \r\n    {\r\n\r\n        this.events.subscribe('countDown:send-security-code:' + this.COUNTDOWN_KEY,()=>{\r\n            this._resetTime(60);\r\n          })\r\n\r\n          this.validateInput();\r\n        this.translateService.get('SIGNUP_VERIFYCODE_SEND').subscribe((value) => {\r\n            this.verifyButtonFixedText = value;\r\n            this.verifyButtonText = this.verifyButtonFixedText;\r\n        })\r\n\r\n        this.country = '+86'                \r\n        \r\n        if (this.session.user != null) {\r\n            this.currentUser = this.session.user;\r\n        }\r\n    }\r\n\r\n    submit() { \r\n        //校验\r\n        if(this.phoneNo == null && this.phoneNo == undefined){\r\n            this.nativeService.alert(this.translateService.instant(\"MY_PHONE_VERIFY\"));\r\n            return\r\n        }\r\n        this.userProvider.setPhone({\r\n            phoneNo : this.country + \" \" + this.phoneNo,\r\n            securityCode:this.verifyCode\r\n\r\n        }).subscribe((data: any) => { \r\n            this.userProvider.getUserInfo().subscribe((data: any) => {\r\n                // this.events.publish('user:info-changed', Date.now());\r\n                this.viewCtrl.dismiss();\r\n            })   \r\n            \r\n        });\r\n    }\r\n    //选择国家地区\r\n    doSelectCountry() {\r\n        let selectModal = this.modalCtrl.create('SelectCountryPage');\r\n        selectModal.onDidDismiss(item => {\r\n          if (item) {\r\n            this.country = \"+\" + item.number;\r\n          }\r\n        })\r\n        selectModal.present();\r\n    }\r\n\r\n    keyUpFn(){\r\n        if(this.verifyCode.length == 6){\r\n            this.switch = true;\r\n        }  else{\r\n            this.switch = false;\r\n          }\r\n    }\r\n\r\n    sendSecurityCodeBefore(){\r\n      this.verifyButtonEnabled = true; \r\n      this.authProvider.sendSecurityCodeBefore('sendSecurityCodeBefore',{\r\n          country: this.country, \r\n          mobilephone: this.phoneNo\r\n        },this.COUNTDOWN_KEY,()=>{\r\n          this.verifyButtonEnabled = false;\r\n        });   \r\n      }\r\n\r\n    getVerifyCode() { \r\n        // Attempt to login in through our User service\r\n        if(this.verifyButtonEnabled){\r\n          return \r\n        }\r\n\r\n        //向手机发送验证码\r\n        this.authProvider.sendSecurityCode({\r\n            country: this.country, \r\n            mobilephone: this.phoneNo\r\n        },\"\").subscribe((resp) => {\r\n          this._resetTime(60);\r\n        }, (err) => {\r\n          // Unable to sign up\r\n          let toast = this.toastCtrl.create({\r\n            message: this.sendCodeErrorString,\r\n            duration: 3000,\r\n            position: 'top'\r\n          });\r\n          toast.present();\r\n          \r\n        });\r\n      }\r\n    \r\n      _resetTime(time: number) {\r\n        let that = this;\r\n        that.verifyButtonEnabled = true;\r\n        (function countdown() {\r\n          // var s = time % 60\r\n          // var m = Math.floor((time / 60)) % 60\r\n          // var msg = `${(m < 10 ? '0' : '') + m}分钟${(s < 10 ? '0' : '') + s}`;\r\n          that.verifyButtonText = time.toString() + that.translateService.instant('APP_DATETIME_SECOND');\r\n          if (--time > 0) {\r\n            setTimeout(countdown, 1000)\r\n            that.cacheProvider.setCountDown(that.COUNTDOWN_KEY, time);\r\n          } else {\r\n            // 做结束的事\r\n            that.verifyButtonText = that.verifyButtonFixedText;\r\n            that.verifyButtonEnabled = false;\r\n          }\r\n        })();\r\n      }\r\n\r\n          /**\r\n   * 判断按钮是否可用；\r\n   * 1.手机号码为空时，所有按钮不可用。\r\n   * 2.当手机号码不为空时，发送验证码按钮可用；验证码为6位时且同意协议时，下一步按钮可用。\r\n   */\r\n  validateInput() {\r\n    if (this.phoneNo) {\r\n\r\n       if(this.cacheProvider.getCountDown(this.COUNTDOWN_KEY)==0){\r\n        this.verifyButtonEnabled = false;\r\n      }\r\n      if(this.verifyCode && this.verifyCode.length == 6){\r\n        this.switch = true;\r\n      }else {\r\n        this.switch = false;\r\n      }\r\n    } else { \r\n      this.verifyButtonEnabled = true;\r\n    }\r\n  }\r\n  \r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/my/updata-phone/updata-phone.ts"],"sourceRoot":""}