{"version":3,"sources":["../../src/pages/home/scan/scan.module.ts","../../src/pages/home/scan/scan.ts"],"names":[],"mappings":"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","file":"63.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\nimport { ScanPage } from './scan';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ScanPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ScanPage),\r\n    TranslateModule.forChild()\r\n  ],\r\n  exports: [\r\n    ScanPage\r\n  ]\r\n})\r\nexport class ScanPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/scan/scan.module.ts","import { Events } from 'ionic-angular';\r\nimport { ViewController } from 'ionic-angular';\r\nimport { APPNAME_PAGE_PREFIX, SCANRESULT_WEBURL } from './../../../services/constants';\r\nimport { NativeService } from './../../../services/native-service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Component, ElementRef } from '@angular/core';\r\nimport { IonicPage, NavController, AlertController } from 'ionic-angular';\r\nimport { QRScanner, QRScannerStatus } from '@ionic-native/qr-scanner';\r\nimport { WidgetProvider } from '../../../providers/providers';\r\nimport { Webpage } from '../../../models/models';\r\nimport { Utility } from '../../../services/utility';\r\n/**\r\n * Generated class for the ScanPage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-scan',\r\n  templateUrl: 'scan.html',\r\n})\r\nexport class ScanPage {\r\n  light: boolean;//判断闪光灯\r\n  frontCamera: boolean;//判断摄像头\r\n  ionTab: any;\r\n  tabbar: any;\r\n  constructor(\r\n    private navCtrl: NavController,\r\n    private qrScanner: QRScanner,\r\n    private alertCtrl: AlertController,\r\n    public widgetProvider: WidgetProvider,\r\n    private translateService: TranslateService,\r\n    private nativeService: NativeService,\r\n    public view: ViewController,\r\n    public events: Events\r\n  ) {\r\n    //默认为false\r\n    this.light = false;\r\n    this.frontCamera = false;  \r\n  }\r\n\r\n  ionViewWillEnter() {\r\n\r\n    this.events.publish('changeTabsDisplay', true)\r\n \r\n    // this.ionTab = <HTMLElement>document.getElementsByTagName(\"ion-tab\")[0];\r\n    // this.tabbar = <HTMLElement>document.getElementsByClassName(\"tabbar\")[0];\r\n    // //隱藏tab頁面，否則會顯示上一層頁面\r\n    // this.ionTab.style.display = \"none\";\r\n    // this.tabbar.style.opacity = 0;\r\n    this.qrScanner.prepare()\r\n      .then((status: QRScannerStatus) => { \r\n        if (status.authorized) {\r\n          \r\n    // this.nativeService.setStatusColor( null,true)\r\n          // camera permission was granted\r\n          // start scanning  \r\n       \r\n          let scanSub = this.qrScanner.scan().subscribe((result: string) => {\r\n        \r\n\r\n            this.qrScanner.hide(); // hide camera preview\r\n            scanSub.unsubscribe(); // stop scanning\r\n\r\n            this.events.publish('changeTabsDisplay', false) \r\n            this.view.dismiss();\r\n            let page: Webpage = {\r\n              url: result,  // 链接地址\r\n              title: \"\",  // 标题\r\n              description: \"\",   // 摘要内容\r\n              imageUrl: \"\",   // 图片路径\r\n              appId: \"\", // 應用ID\r\n              options: {\r\n                canShare: true\r\n              }\r\n            };\r\n            if(result){\r\n              result = result.trim()\r\n              // 如果是URL 或者 iProud:// 开发的链接，不作处理\r\n              if( !Utility.isUrl(result) && result.indexOf(`${APPNAME_PAGE_PREFIX.toLowerCase()}AppPageId`) == -1){\r\n                 //非URL 并且非 iProud:// 开发的链接，链接到后台处理\r\n                page.url = `${SCANRESULT_WEBURL}?result=${encodeURIComponent(result)}`;\r\n              }\r\n            } \r\n            this.widgetProvider.openWebpage(page, this.navCtrl);\r\n          });\r\n\r\n          \r\n          // show camera preview\r\n          this.qrScanner.show();\r\n\r\n          // wait for user to scan something, then the observable callback will be called\r\n        } else if (status.denied) {\r\n          this.showOpenSettingAlert();\r\n          // camera permission was permanently denied\r\n          // you must use QRScanner.openSettings() method to guide the user to the settings page\r\n          // then they can grant the permission from there\r\n        } else {\r\n          //alert(\"臨時無權限\");\r\n          this.showOpenSettingAlert();\r\n          // permission was denied, but not permanently. You can ask for permission again at a later time.\r\n        }\r\n      })\r\n      .catch((e: any) => {\r\n        this.showOpenSettingAlert();\r\n        console.error('Error is', e)\r\n      });\r\n  }\r\n\r\n\r\n\r\n  ionViewDidEnter() {\r\n    //页面可见时才执行 \r\n    this.showCamera();\r\n  }\r\n\r\n\r\n  //是否需要打开相机设置\r\n  showOpenSettingAlert() {\r\n    if (this.nativeService.isMobile()) {\r\n      let confirm = this.alertCtrl.create({\r\n        title: this.translateService.instant('SCANNER_SETTING_REQUEST'),\r\n        message: this.translateService.instant('SCANNER_SETTING_OPENSETTING'),\r\n        buttons: [\r\n          {\r\n            text: this.translateService.instant('APP_COMMON_CANCEL'),\r\n            handler: () => { \r\n            }\r\n          },\r\n          {\r\n            text: this.translateService.instant('APP_COMMON_CONFIRM'),\r\n            handler: () => {\r\n              //打开相机设置\r\n              this.qrScanner.openSettings(); \r\n            }\r\n          }\r\n        ]\r\n      });\r\n      confirm.present();\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n * 闪光灯控制，默认关闭\r\n   */\r\n  toggleLight() {\r\n    if (this.light) {\r\n      this.qrScanner.disableLight();\r\n    } else {\r\n      this.qrScanner.enableLight();\r\n    }\r\n    this.light = !this.light;\r\n  }\r\n\r\n  /**\r\n  * 前后摄像头互换\r\n */\r\n  toggleCamera() {\r\n    if (this.frontCamera) {\r\n      this.qrScanner.useBackCamera();\r\n    } else {\r\n      this.qrScanner.useFrontCamera();\r\n    }\r\n    this.frontCamera = !this.frontCamera;\r\n  }\r\n\r\n  showCamera() {\r\n    (window.document.querySelector('ion-app') as HTMLElement).classList.add('cameraView');\r\n  }\r\n  hideCamera() {\r\n    (window.document.querySelector('ion-app') as HTMLElement).classList.remove('cameraView');\r\n    // alert(\"disableLight\");\r\n    this.qrScanner.disableLight();\r\n    // alert(\"hide\")\r\n    this.qrScanner.hide().then((result) => {\r\n      // alert(\"hide result:\" + JSON.stringify(result));\r\n    });//需要关闭扫描，否则相机一直开着\r\n\r\n    this.qrScanner.destroy().then((result) => {\r\n      // alert(\"destory result:\" + JSON.stringify(result));\r\n    }); \r\n  }\r\n\r\n  //离开页面时，恢复显示tab页，且關閉相機\r\n  ionViewWillLeave() {\r\n    // if (this.ionTab) this.ionTab.style.display = \"block\";\r\n    // if (this.tabbar) this.tabbar.style.opacity = 1;\r\n    this.hideCamera();\r\n    this.events.publish('changeTabsDisplay', false)\r\n    // this.nativeService.setStatusColor()\r\n    \r\n  }\r\n \r\n  goBack(){\r\n    this.navCtrl.pop()\r\n  }\r\n \r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/scan/scan.ts"],"sourceRoot":""}