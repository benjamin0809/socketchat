{"version":3,"sources":["../../src/pages/beta/send-message/send-message.module.ts","../../src/pages/beta/send-message/send-message.ts"],"names":[],"mappings":"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","file":"108.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { SendMessagePage } from './send-message';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    SendMessagePage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(SendMessagePage),\r\n  ],\r\n})\r\nexport class SendMessagePageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/beta/send-message/send-message.module.ts","import { ClubProvider } from './../../../providers/club-provider';\r\nimport { NativeService } from './../../../services/native-service';\r\nimport { ViewChild } from '@angular/core';\r\nimport { SqliteProvider } from './../../../providers/sqlite-provider';\r\nimport { Session } from './../../../services/session';\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, Events, AlertController } from 'ionic-angular';\r\n\r\n/**\r\n * Generated class for the SendMessagePage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-send-message',\r\n  templateUrl: 'send-message.html',\r\n})\r\nexport class SendMessagePage {\r\n\r\n  @ViewChild('fileInput') fileInput;\r\n  message: any = {\r\n    widgetId: 0,\r\n    messageId: 0,\r\n    widgetName: 'iProud',\r\n    widgetIcon: '',\r\n    formatType: 'image',\r\n    title: '',\r\n    abstract: '',\r\n    imageUrl: '',\r\n    redirectUrl: '',\r\n    groudId: 0, //群组id\r\n    senderId: '', //发送人id\r\n    senderName: '',//发送人名称\r\n    senderAvator: '',//发送人头像\r\n    fromType: '',//发送来源类型 \r\n  };\r\n  formatTypes: any = []\r\n  fromTypes: any = []\r\n  extraFromTypes: any = []\r\n  widgetList: any = []; \r\n  boardList: any = [];\r\n  Friends: any = [];\r\n  constructor(public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    public session: Session,\r\n    public events: Events,\r\n    public sqliteProvider:SqliteProvider,\r\n    public alertCtrl: AlertController,\r\n    public nativeService: NativeService,\r\n    public clubProvider: ClubProvider\r\n    ) {\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    this.formatTypes = ['widget', 'text', 'image', 'headerimage', 'titleinimage', 'richtextimage',]\r\n    this.extraFromTypes = [ 'Video', 'Board', 'Club']\r\n    this.fromTypes = ['Chat', 'AdminConsole']\r\n    this.fromTypes.push.apply(this.fromTypes, this.extraFromTypes)\r\n    this.message.messageId = +new Date()\r\n    this.widgetList.push({\r\n      widgetId: 0, widgetName: 'iProud',\r\n      widgetIcon: ''\r\n    })\r\n    this.session.widget.forEach(v => {\r\n      v.widgets.forEach(element => {\r\n        let widget = {\r\n          widgetId: element.id,\r\n          widgetName: element.widgetName,\r\n          widgetIcon: element.iconUrl\r\n        }\r\n        this.widgetList.push(widget)\r\n      });\r\n    })\r\n    this.sqliteProvider.queryContacts().subscribe((friends) => {\r\n      friends.forEach(friend=>{\r\n        let extra = JSON.parse(friend.Extra) \r\n        let friendItem = {\r\n          senderId: extra.id,\r\n          senderName: extra.aliasName || extra.name,\r\n          senderAvator: extra.avator\r\n        }\r\n        this.Friends.push(friendItem)\r\n      }) \r\n    })\r\n\r\n    this.extraFromTypes.forEach(channel => {\r\n      this.clubProvider.getMyClubs(this.session.user.employeeInfo.siteCode, channel).subscribe(res => {\r\n\r\n        res.result.forEach(element => {\r\n          let widget = {\r\n            widgetId: element.boardId,\r\n            widgetName: element.displayName,\r\n            widgetIcon: element.iconUrl,\r\n            type: channel \r\n          }\r\n          this.boardList.push( widget)\r\n        });\r\n        \r\n      }, err => {\r\n      }, () => { \r\n      });\r\n    });\r\n    \r\n  }\r\n\r\n  filterBoard(type: string){\r\n    if(!type){\r\n        return []\r\n    } \r\n\r\n    let array = this.boardList.filter(item => item.type === type)\r\n    return  array\r\n  }\r\n  selectWidget(widgetid) {\r\n    this.widgetList.forEach(element => {\r\n      if (element.widgetId == widgetid) {\r\n        this.message.senderId = element.widgetId\r\n        this.message.widgetId = element.widgetId\r\n        this.message.senderName = element.widgetName\r\n        this.message.senderAvator = element.widgetIcon\r\n        this.message.widgetName = element.widgetName\r\n        this.message.widgetIcon = element.widgetIcon\r\n      }\r\n    });\r\n  }\r\n\r\n  selectBoard(widgetid) {\r\n    this.boardList.forEach(element => {\r\n      if (element.widgetId == widgetid) {\r\n        this.message.senderId = element.widgetId\r\n        this.message.widgetId = element.widgetId\r\n        this.message.senderName = element.widgetName\r\n        this.message.senderAvator = element.widgetIcon\r\n        this.message.widgetName = element.widgetName\r\n        this.message.widgetIcon = element.widgetIcon\r\n      }\r\n    });\r\n  }\r\n  \r\n\r\n  selectFriend(senderId) {\r\n    this.Friends.forEach(element => {\r\n      if (element.senderId == senderId) {\r\n        this.message.senderId = element.senderId\r\n        this.message.widgetId = element.senderId\r\n        this.message.senderName = element.senderName\r\n        this.message.senderAvator = element.senderAvator\r\n        this.message.widgetName = element.senderName\r\n        this.message.widgetIcon = element.senderAvator\r\n      }\r\n    });\r\n  }\r\n\r\n  processWebImage(event) {\r\n    let filesList = event.target.files;\r\n    for(let file of filesList){ \r\n      let reader = new FileReader();\r\n      reader.onload = (readerEvent) => { \r\n        let imageData = (readerEvent.target as any).result; \r\n        this.message.imageUrl = imageData;\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }  \r\n  }\r\n\r\n  openPhoneGallery() {\r\n    if (this.nativeService.isMobile()) {\r\n      this.nativeService.getFullPictureByPhotoLibrary({//从相册多选\r\n        destinationType: 0//期望返回的图片格式,0图片字符串\r\n      }).subscribe(img => {\r\n         this.message.imageUrl = img;\r\n      }, (err) => {\r\n        this.nativeService.showToast(err)\r\n      });\r\n    } else {\r\n      this.fileInput.nativeElement.click();\r\n\r\n    }\r\n  }\r\n\r\n  send() {\r\n    // console.log(this.message)\r\n    this.events.publish('iProud.receiveNotification', this.message ); \r\n    let alert = this.alertCtrl.create() \r\n    alert.setSubTitle('发送完成')\r\n    alert.addButton({\r\n      text: 'Stay',\r\n      handler: data => {\r\n        this.message.messageId = +new Date()\r\n      } \r\n    }); \r\n    alert.addButton({\r\n      text: 'Back to Tabs',\r\n      handler: data => {  \r\n        this.popToMylistPage()\r\n      }\r\n    });\r\n    alert.present();\r\n    \r\n  }\r\n /**\r\n   * 返回到好友列表\r\n   */\r\n  popToMylistPage(){  \r\n    for(let i = 0; i < this.navCtrl.length();i++ ){\r\n      let view = this.navCtrl.getByIndex(i);\r\n      if(view.name == 'MyListPage' || view.id == 'MyListPage'){\r\n        this.navCtrl.popTo(view)\r\n      }\r\n    }\r\n    \r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/beta/send-message/send-message.ts"],"sourceRoot":""}