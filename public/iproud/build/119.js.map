{"version":3,"sources":["../../src/pages/account/identify-code/identify-code.module.ts","../../src/pages/account/identify-code/identify-code.ts"],"names":[],"mappings":"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","file":"119.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { IdentifyCodePage } from './identify-code';\r\n\r\nimport { TranslateModule } from '@ngx-translate/core';\r\n@NgModule({\r\n  declarations: [\r\n    IdentifyCodePage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(IdentifyCodePage),\r\n    TranslateModule.forChild()\r\n  ],\r\n})\r\nexport class IdentifyCodePageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/account/identify-code/identify-code.module.ts","import { Utility } from './../../../services/utility';\r\nimport { Events, IonicApp } from 'ionic-angular';\r\nimport { NativeService } from './../../../services/native-service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { ErrorCode } from './../../../services/errcode';\r\n\r\nimport { ViewController } from 'ionic-angular';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { AuthProvider } from './../../../providers/auth-provider';\r\nimport { Component, ViewChild } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\r\nimport { FormBuilder, FormGroup } from '@angular/forms'; \r\n/**\r\n * 验证码页面\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-identify-code',\r\n  templateUrl: 'identify-code.html',\r\n})\r\nexport class IdentifyCodePage {\r\n  @ViewChild(\"keyword\") keywordInput;\r\n  identifyCodeUrl: any; //验证码对象\r\n  sendButtonDisabled: boolean = true; //发送按钮是否可用\r\n  identifyForm: FormGroup;  //表单\r\n  errorString: string = '';   //验证码错误提示\r\n  accountInfo: any;   //账号信息\r\n  inputType: string = ''; //使用验证码类型\r\n  clientId: string = ''; //获取验证码clientId\r\n  constructor(public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    public authProvider: AuthProvider,\r\n    private sanitizer: DomSanitizer,\r\n    public viewController: ViewController,\r\n    public formBuilder: FormBuilder,\r\n    public translateService: TranslateService,\r\n    public nativeService: NativeService,\r\n    public events: Events,\r\n    public ionicApp: IonicApp) {\r\n    this._buildForm()\r\n    this.accountInfo = this.navParams.data.accountInfo;\r\n    this.inputType = this.navParams.data.inputType;\r\n    this.clientId = this.navParams.data.clientId;\r\n \r\n  }\r\n\r\n\r\n  ionViewDidLoad() {\r\n    this.getIdentifyCode()\r\n  }\r\n\r\n  /**\r\n   * 获取验证码\r\n   */\r\n  getIdentifyCode() { \r\n    this.authProvider.MessageCaptcha(this.clientId).subscribe(res => {\r\n      if (res.result && res.result.image) {\r\n        if (res.result.image.indexOf('data:image/jpeg;base64,') == -1) {\r\n          this.identifyCodeUrl = this.sanitizer.bypassSecurityTrustResourceUrl('data:image/jpeg;base64,' + res.result.image);\r\n        } else {\r\n          this.identifyCodeUrl = this.sanitizer.bypassSecurityTrustResourceUrl(res.result.image);\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  refreshVerifyCode(){\r\n    this.keywordInput.setFocus();//为输入框设置焦点\r\n    this.getIdentifyCode()\r\n  }\r\n  /**\r\n   * 关闭当前窗口\r\n   */\r\n  closeWindow() {\r\n    this.events.publish('Verification:close-window');\r\n    if(this.viewController){\r\n      this.viewController.dismiss(); \r\n    }\r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    setTimeout(() => {\r\n      this.keywordInput.setFocus();//为输入框设置焦点\r\n    }, 150);\r\n  }\r\n  \r\n  closeAllModalPage() {\r\n    this.events.publish('closemodal:login-success') \r\n  }\r\n  \r\n  /**\r\n   * 校验验证码\r\n   */\r\n  sendVerificationCode() {\r\n    \r\n    let identifyCode = Utility.trim(this.identifyForm.controls.identifyCode.value);\r\n    switch (this.inputType) {\r\n\r\n      case 'sendSecurityCodeBefore':\r\n        this.authProvider.SendSecurityCode2(this.accountInfo, identifyCode, this.navParams.data.countDownKey)\r\n          .subscribe(res => {\r\n            this.closeWindow();\r\n            // this.closeAllModalPage()\r\n          }, err => {\r\n            this.verificationErrorHandle(err)\r\n          });\r\n        break;\r\n      case 'LoginByWFAccountBefore':\r\n        this.authProvider.LoginByWFAccount2(this.accountInfo, identifyCode)\r\n          .subscribe(res => {\r\n            // this.closeWindow();\r\n            this.closeAllModalPage()\r\n          }, err => {\r\n            this.verificationErrorHandle(err, true)\r\n          })\r\n        break;\r\n      case 'LoginByMobileBefore':\r\n        this.authProvider.Login2(this.accountInfo, identifyCode)\r\n          .subscribe(res => {\r\n            // this.closeWindow();\r\n            this.closeAllModalPage()\r\n          }, err => {\r\n            this.verificationErrorHandle(err, true)\r\n          })\r\n        break;\r\n    }\r\n\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * 验证失败处理\r\n   * @param err \r\n   * @param isLogin 是否为登录\r\n   */\r\n  verificationErrorHandle(err: any, isLogin?: boolean) {\r\n    if (err.errcode == ErrorCode.USER.INCORRECT_VERIFICATION_CODE) {\r\n      this.errorString = this.translateService.instant('VERIFICATION_CODE_INCORRECT');\r\n      this.getIdentifyCode();\r\n    } else if (err.errcode == ErrorCode.USER.VERIFICATION_CODE_EXPIRED) {\r\n      this.errorString = this.translateService.instant('VERIFICATION_CODE_EXPIRED');\r\n      this.getIdentifyCode();\r\n    } else {\r\n      this.loginError(err);\r\n      this.closeWindow();\r\n    }\r\n  }\r\n\r\n  _buildForm() {\r\n    this.identifyForm = this.formBuilder.group({\r\n      identifyCode: ['']\r\n    });\r\n\r\n    this.identifyForm.controls.identifyCode.valueChanges.subscribe(value => {\r\n      this.sendButtonDisabled = value ? false : true;\r\n      this.errorString = \"\";\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 登录失败处理\r\n   * @param err \r\n   */\r\n  loginError(err) {\r\n    let loginErrorString = '';\r\n    switch (err.errcode) {\r\n      case ErrorCode.USER.INACTIVE_USER: loginErrorString = \"ACCOUNT_LOCKED\";\r\n        break;\r\n      case ErrorCode.USER.USER_NOT_EXIST: loginErrorString = \"LOGIN_ERROR_USER_NOT_EXIST\";\r\n        break;\r\n      case ErrorCode.USER.MOBILE_NOT_EXIST: loginErrorString = \"LOGIN_ERROR_PHONE_NUMBER_NOT_EXIST\";\r\n        break;\r\n      case ErrorCode.USER.INCORRECT_ACCOUNT_AND_PASSWORD: loginErrorString = \"LOGIN_ERROR_INCORRECT_PASSWORD\";\r\n        break;\r\n      case ErrorCode.USER.INCORRECT_PASSWORD: loginErrorString = \"LOGIN_ERROR_INCORRECT_PASSWORD\";\r\n        break;\r\n\r\n      default: loginErrorString = 'LOGIN_ERROR';\r\n    }\r\n    this.nativeService.alert(this.translateService.instant(loginErrorString));\r\n  }\r\n \r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/account/identify-code/identify-code.ts"],"sourceRoot":""}