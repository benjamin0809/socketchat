(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{nLkt:function(n,t,l){"use strict";l.r(t);var e=l("8Y7J");class i{}var o=l("pMnS"),s=l("1bmy"),r=l("liwm"),u=l("riPR"),a=l("ZwiA"),c=l("TSSN"),b=l("oBZk"),g=l("ZZ/e"),h=l("SVse");class d{constructor(n){this.element=n}ngAfterViewInit(){this.badge&&parseInt(this.badge,10)>999&&(this.badge="...")}}var m=e.pb({encapsulation:0,styles:[[".info-tip[_ngcontent-%COMP%]{background:#fa3c00;position:absolute;line-height:1.5rem;min-width:1.5rem;min-height:1.5rem;top:-.5rem;right:-.5rem;border-radius:50%;padding:1px;font-size:small}.info[_ngcontent-%COMP%]{position:relative;color:#fff;text-align:center;border-radius:50%;display:inline-block}.avatar[_ngcontent-%COMP%]{border-radius:50%;min-width:40px}"]],data:{}});function p(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,1,"span",[["class","info-tip"]],null,null,null,null,null)),(n()(),e.Jb(1,null,["",""]))],null,(function(n,t){n(t,1,0,t.component.badge)}))}function f(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,3,"div",[["class","info"]],null,null,null,null,null)),(n()(),e.rb(1,0,null,null,0,"img",[["class","avatar"]],[[8,"src",4]],null,null,null,null)),(n()(),e.gb(16777216,null,null,1,null,p)),e.qb(3,16384,null,0,h.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null)],(function(n,t){n(t,3,0,t.component.badge>0)}),(function(n,t){n(t,1,0,e.vb(1,"",t.component.src,""))}))}var M=l("mrSG"),v=l("VvKu"),x=l("yHx4"),k=l("4DE5"),C=l("VGsI"),S=l("fg/S"),E=l("m6VD");class _{constructor(n,t,l,e,i,o,s,r,u,a,c,b){this.navCtrl=n,this.messageProvider=t,this.eventsService=l,this.session=e,this.alertCtrl=i,this.translateService=o,this.actionSheetCtrl=s,this.cd=r,this.sqlServiceProvider=u,this.handle=a,this.configProvider=c,this.router=b,this.isDataLoading=!1,this.isDataEmpty=!1,this.page=0,this.pageCount=30,this.isShowCheckBox=!1}ngOnInit(){const n=this.messageProvider.getMessageSession();n&&n.length>0?this.chats=n:this.initMessage(),this.eventsService.on(v.h.ReceivedNotification,()=>{this.initMessage()}),this.eventsService.on(v.o.LangChangedRefresh,()=>{this.formatGroupsTime()}),this.eventsService.on(v.i.Changed,()=>{this.initMessage()}),this.eventsService.on(v.o.MessageSessionRefresh,()=>{this.initMessage()}),this.eventsService.on(v.f.Initialize,()=>{this.initMessage()})}detectChange(){this.cd.destroyed||this.cd.detectChanges()}openContactList(){this.router.navigate(["ContactPage"])}initMessage(n){this.messageProvider.getMessageChat().subscribe(t=>{this.isDataEmpty=0===t.length,this.chats=t,this.createMessageArray(),n&&n.target.complete()},n=>{this.configProvider.initDatabase()})}openDetails(n){this.messageProvider.goMessageList({widgetId:n.id,widgetIcon:n.sessionIcon,widgetName:n.sessionName||"unknown",fromType:n.extra.fromType,messages:[]},this.router)}deleteSession(n){this.messageProvider.deleteMessageBySessionId(n.id);const t=this.chats.findIndex(t=>t.id===n.id);this.chats.splice(t,1),this.isMoreData()}updateMessageStatus(){this.chats=this.messageProvider.updateGroups(),this.page=0}doRefresh(n){this.initMessage(n)}doInfinite(n){this.createMessageArray(),setTimeout(()=>{n.target.complete()},1e3)}createMessageArray(){this.formatGroupsTime(),this.isMoreData(),this.detectChange()}isMoreData(){this.chats.length>0?(this.finiteScroll=!0,this.page++):this.finiteScroll=!1}formatGroupsTime(){for(const n of this.chats)n.displayTime=C.a.formatMessageGroupTime(this.session.language,Number(n.latestTime)),n.sessionName=this._getWidgetNameById(n.id)||n.sessionName}_getWidgetNameById(n){if(!this.session.LangContexts)return"";for(const t of this.session.LangContexts)if(n===t.keyId)return t.content;return""}showDeleteMsg(n){return M.b(this,void 0,void 0,(function*(){const t=yield this.alertCtrl.create({header:this.translateService.instant("MESSAGE_DELETE_TITLE"),message:this.translateService.instant("MESSAGE_DELETE_MESSAGE"),buttons:[{text:this.translateService.instant("MESSAGE_DELETE_CANCEL"),handler:()=>{}},{text:this.translateService.instant("MESSAGE_DELETE_CONFIRM"),handler:()=>{this.deleteSession(n)}}]});yield t.present()}))}setStickyOnTop(n,t){this.messageProvider.setMessageSessionTopStatusFlag(n,t?0:1),this.createMessageArray()}}var P=l("iInd"),O=e.pb({encapsulation:0,styles:[[".header-icon[_ngcontent-%COMP%]{width:2.4rem;margin-left:5px}.badge[_ngcontent-%COMP%]:after{content:attr(num);line-height:1.6rem;text-align:center;width:1.6rem;height:1.6rem;border-radius:50%;background-color:red;position:absolute;top:-.5rem;right:-.5rem}.item-ios[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], ion-img[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%}ion-note[slot=end][_ngcontent-%COMP%]{padding-left:8px;margin-left:0}ion-avatar[_ngcontent-%COMP%]{margin-right:8px}.latest-time[_ngcontent-%COMP%]{float:right;font-size:1rem;color:gray}h3[_ngcontent-%COMP%]{color:gray;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.group-title[_ngcontent-%COMP%]{max-width:70%}.theme-light[_ngcontent-%COMP%]   .inner-item[_ngcontent-%COMP%]:active{background:#dfdfdf}.theme-light[_ngcontent-%COMP%]   .sticky-top[_ngcontent-%COMP%]{background-color:#e7e7e7}.theme-light[_ngcontent-%COMP%]   .sticky-top[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{border-bottom:1.2px solid #e7e7e7!important}.theme-dark[_ngcontent-%COMP%]   .inner-item[_ngcontent-%COMP%]:active{background:#424242}.theme-dark[_ngcontent-%COMP%]   .sticky-top[_ngcontent-%COMP%]{background-color:#343434}.theme-dark[_ngcontent-%COMP%]   .sticky-top[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{border-bottom:1.2px solid #343434!important}.sc-ion-label-ios-h[_ngcontent-%COMP%], .sc-ion-label-ios-s[_ngcontent-%COMP%]{margin-left:8px;padding-top:4px;padding-bottom:4px}ion-list[_ngcontent-%COMP%]   ion-item-sliding[_ngcontent-%COMP%]:last-child{border-bottom:var(--border-primary)}ion-list[_ngcontent-%COMP%]   ion-item-sliding[_ngcontent-%COMP%]:last-child   ion-item[_ngcontent-%COMP%]{--inner-border-width:0}"]],data:{}});function y(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,2,"nodata",[["translateKey","MESSAGE_EMPTY"]],null,null,null,s.b,s.a)),e.qb(1,114688,null,0,r.a,[u.a,a.a,e.h,c.k],{text:[0,"text"],translateKey:[1,"translateKey"]},null),e.Eb(131072,c.j,[c.k,e.h])],(function(n,t){n(t,1,0,e.vb(1,"",e.Kb(t,1,0,e.Db(t,2).transform("MESSAGE_EMPTY")),""),"MESSAGE_EMPTY")}),null)}function T(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,3,"ion-item-option",[["color","medium"]],null,[[null,"click"]],(function(n,t,l){var e=!0;return"click"===t&&(e=!1!==n.component.setStickyOnTop(n.parent.context.$implicit.id,null==n.parent.context.$implicit?null:n.parent.context.$implicit.isTop)&&e),e}),b.Cb,b.z)),e.qb(1,49152,null,0,g.M,[e.h,e.k,e.x],{color:[0,"color"]},null),(n()(),e.Jb(2,0,[" "," "])),e.Eb(131072,c.j,[c.k,e.h])],(function(n,t){n(t,1,0,"medium")}),(function(n,t){n(t,2,0,e.Kb(t,2,0,e.Db(t,3).transform("MESSAGE_GROUP_STICKY_ON_TOP")))}))}function w(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,3,"ion-item-option",[["color","medium"]],null,[[null,"click"]],(function(n,t,l){var e=!0;return"click"===t&&(e=!1!==n.component.setStickyOnTop(n.parent.context.$implicit.id,null==n.parent.context.$implicit?null:n.parent.context.$implicit.isTop)&&e),e}),b.Cb,b.z)),e.qb(1,49152,null,0,g.M,[e.h,e.k,e.x],{color:[0,"color"]},null),(n()(),e.Jb(2,0,[" "," "])),e.Eb(131072,c.j,[c.k,e.h])],(function(n,t){n(t,1,0,"medium")}),(function(n,t){n(t,2,0,e.Kb(t,2,0,e.Db(t,3).transform("MESSAGE_GROUP_REMOVE_STICKY")))}))}function I(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,31,"ion-item-sliding",[],null,null,null,b.Eb,b.B)),e.qb(1,49152,null,0,g.O,[e.h,e.k,e.x],null,null),(n()(),e.rb(2,0,null,0,19,"ion-item",[["class","ion-activatable ion-activatable-radius"],["slot","start"]],null,[[null,"click"]],(function(n,t,l){var e=!0;return"click"===t&&(e=!1!==n.component.openDetails(n.context.$implicit)&&e),e}),b.Fb,b.y)),e.qb(3,49152,null,0,g.J,[e.h,e.k,e.x],null,null),e.Gb(512,null,h.v,h.w,[e.q,e.r,e.k,e.B]),e.qb(5,278528,null,0,h.h,[h.v],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),e.Fb(6,{"sticky-top":0}),(n()(),e.rb(7,0,null,0,3,"ion-avatar",[],null,null,null,b.fb,b.b)),e.qb(8,49152,null,0,g.h,[e.h,e.k,e.x],null,null),(n()(),e.rb(9,0,null,0,1,"avatar-badge",[],null,null,null,f,m)),e.qb(10,4243456,null,0,d,[e.k],{src:[0,"src"],badge:[1,"badge"]},null),(n()(),e.rb(11,0,null,0,5,"ion-label",[],null,null,null,b.Gb,b.C)),e.qb(12,49152,null,0,g.P,[e.h,e.k,e.x],null,null),(n()(),e.rb(13,0,null,0,1,"h2",[],null,null,null,null,null)),(n()(),e.Jb(14,null,["",""])),(n()(),e.rb(15,0,null,0,1,"h3",[],null,null,null,null,null)),(n()(),e.Jb(16,null,["",""])),(n()(),e.rb(17,0,null,0,2,"ion-note",[["class","latest-time"],["slot","end"]],null,null,null,b.Jb,b.F)),e.qb(18,49152,null,0,g.ab,[e.h,e.k,e.x],null,null),(n()(),e.Jb(19,0,[" "," "])),(n()(),e.rb(20,0,null,0,1,"ion-ripple-effect",[],null,null,null,b.Ob,b.K)),e.qb(21,49152,null,0,g.jb,[e.h,e.k,e.x],null,null),(n()(),e.rb(22,0,null,0,9,"ion-item-options",[["side","end"]],null,null,null,b.Db,b.A)),e.qb(23,49152,null,0,g.N,[e.h,e.k,e.x],{side:[0,"side"]},null),(n()(),e.gb(16777216,null,0,1,null,T)),e.qb(25,16384,null,0,h.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.gb(16777216,null,0,1,null,w)),e.qb(27,16384,null,0,h.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.rb(28,0,null,0,3,"ion-item-option",[["color","danger"]],null,[[null,"click"]],(function(n,t,l){var e=!0;return"click"===t&&(e=!1!==n.component.showDeleteMsg(n.context.$implicit)&&e),e}),b.Cb,b.z)),e.qb(29,49152,null,0,g.M,[e.h,e.k,e.x],{color:[0,"color"]},null),(n()(),e.Jb(30,0,[" "," "])),e.Eb(131072,c.j,[c.k,e.h])],(function(n,t){var l=n(t,6,0,null==t.context.$implicit?null:t.context.$implicit.isTop);n(t,5,0,"ion-activatable ion-activatable-radius",l),n(t,10,0,null==t.context.$implicit?null:t.context.$implicit.sessionIcon,e.vb(1,"",null==t.context.$implicit?null:t.context.$implicit.unreadCount,"")),n(t,23,0,"end"),n(t,25,0,!(null!=t.context.$implicit&&t.context.$implicit.isTop)),n(t,27,0,null==t.context.$implicit?null:t.context.$implicit.isTop),n(t,29,0,"danger")}),(function(n,t){n(t,14,0,null==t.context.$implicit?null:t.context.$implicit.sessionName),n(t,16,0,null==t.context.$implicit?null:t.context.$implicit.latestMessageTitle),n(t,19,0,null==t.context.$implicit?null:t.context.$implicit.displayTime),n(t,30,0,e.Kb(t,30,0,e.Db(t,31).transform("MESSAGE_GROUP_DELETE")))}))}function B(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,7,"ion-header",[],null,null,null,b.wb,b.s)),e.qb(1,49152,null,0,g.D,[e.h,e.k,e.x],null,null),(n()(),e.rb(2,0,null,0,5,"ion-toolbar",[],null,null,null,b.hc,b.db)),e.qb(3,49152,null,0,g.Eb,[e.h,e.k,e.x],null,null),(n()(),e.rb(4,0,null,0,3,"ion-title",[["class","title"]],null,null,null,b.fc,b.bb)),e.qb(5,49152,null,0,g.Cb,[e.h,e.k,e.x],null,null),(n()(),e.Jb(6,0,["",""])),e.Eb(131072,c.j,[c.k,e.h]),(n()(),e.rb(8,0,null,null,11,"ion-content",[],null,null,null,b.rb,b.n)),e.qb(9,49152,null,0,g.w,[e.h,e.k,e.x],null,null),(n()(),e.rb(10,0,null,0,3,"ion-refresher",[["slot","fixed"]],null,[[null,"ionRefresh"]],(function(n,t,l){var e=!0;return"ionRefresh"===t&&(e=!1!==n.component.doRefresh(l)&&e),e}),b.Nb,b.I)),e.qb(11,49152,null,0,g.fb,[e.h,e.k,e.x],null,null),(n()(),e.rb(12,0,null,0,1,"ion-refresher-content",[["pullingIcon","arrow-dropdown"]],null,null,null,b.Mb,b.J)),e.qb(13,49152,null,0,g.gb,[e.h,e.k,e.x],{pullingIcon:[0,"pullingIcon"]},null),(n()(),e.rb(14,0,null,0,5,"ion-list",[],null,null,null,b.Ib,b.D)),e.qb(15,49152,null,0,g.Q,[e.h,e.k,e.x],null,null),(n()(),e.gb(16777216,null,0,1,null,y)),e.qb(17,16384,null,0,h.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.gb(16777216,null,0,1,null,I)),e.qb(19,278528,null,0,h.i,[e.M,e.J,e.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,t){var l=t.component;n(t,13,0,"arrow-dropdown"),n(t,17,0,l.isDataEmpty),n(t,19,0,l.chats)}),(function(n,t){n(t,6,0,e.Kb(t,6,0,e.Db(t,7).transform("MESSAGE_TITLE")))}))}function q(n){return e.Lb(0,[(n()(),e.rb(0,0,null,null,1,"page-message-session",[],null,null,null,B,O)),e.qb(1,114688,null,0,_,[g.Lb,S.a,u.a,a.a,g.b,c.k,g.a,e.h,E.a,k.a,x.a,P.m],null,null)],(function(n,t){n(t,1,0)}),null)}var D=e.nb("page-message-session",_,q,{},{},[]),G=l("s7LF"),L=l("j1ZV");l.d(t,"MessageSessionPageModuleNgFactory",(function(){return $}));var $=e.ob(i,[],(function(n){return e.Ab([e.Bb(512,e.j,e.Z,[[8,[o.a,D]],[3,e.j],e.v]),e.Bb(4608,h.l,h.k,[e.s,[2,h.A]]),e.Bb(4608,g.c,g.c,[e.x,e.g]),e.Bb(4608,g.Kb,g.Kb,[g.c,e.j,e.p]),e.Bb(4608,g.Ob,g.Ob,[g.c,e.j,e.p]),e.Bb(4608,G.r,G.r,[]),e.Bb(4608,G.d,G.d,[]),e.Bb(4608,c.g,c.f,[]),e.Bb(4608,c.c,c.e,[]),e.Bb(4608,c.i,c.d,[]),e.Bb(4608,c.b,c.a,[]),e.Bb(4608,c.k,c.k,[c.l,c.g,c.c,c.i,c.b,c.m,c.n]),e.Bb(5120,e.d,(function(n,t,l){return[g.Ub(n,t,l)]}),[g.Tb,h.c,e.x]),e.Bb(1073742336,h.b,h.b,[]),e.Bb(1073742336,g.Gb,g.Gb,[]),e.Bb(1073742336,P.n,P.n,[[2,P.t],[2,P.m]]),e.Bb(1073742336,c.h,c.h,[]),e.Bb(1073742336,G.q,G.q,[]),e.Bb(1073742336,G.h,G.h,[]),e.Bb(1073742336,G.o,G.o,[]),e.Bb(1073742336,L.a,L.a,[]),e.Bb(1073742336,i,i,[]),e.Bb(256,c.n,void 0,[]),e.Bb(256,c.m,void 0,[]),e.Bb(256,g.Tb,void 0,[]),e.Bb(1024,P.k,(function(){return[[{path:"",component:_}]]}),[])])}))}}]);